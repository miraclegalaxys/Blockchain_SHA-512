flowchart TD
   %% การเริ่มต้น Node A
   A1[Node A: เริ่มต้น] --> A2[ตั้งค่า BlockConfig]
   A2 --> A3[สร้าง BlockchainClient]

   %% การรับข้อมูลจากผู้ใช้และการประมวลผลเบื้องต้น
   A3 --> A4[รับข้อมูลจากผู้ใช้สำหรับเนื้อหาข้อมูล]
   A4 --> A5{ข้อมูลว่างหรือไม่?}
   A5 -->|ใช่| A6[บันทึกข้อผิดพลาด: เนื้อหาว่างเปล่า]
   A5 -->|ไม่ใช่| A7[คำนวณแฮชข้อมูล SHA-512]

   %% การสร้างบล็อก
   A7 --> A8[สร้างบล็อกใหม่พร้อมด้วย:]
   A8 --> A8a[/"
       - index: 1
       - previous_hash: '0'
       - data_hash
       - data_content
       - timestamp
       - calculated hash
   "/]

   %% การเชื่อมต่อไปยัง Node B
   A8a --> A9[เริ่มต้นการเชื่อมต่อซ็อกเก็ต]
   A9 --> A10{การเชื่อมต่อสำเร็จหรือไม่?}
   A10 -->|ไม่| A11[บันทึกข้อผิดพลาดในการเชื่อมต่อ]
   A10 -->|ใช่| A12[แปลงบล็อกเป็น JSON]
   A12 --> A13[ส่งข้อมูลบล็อกไปยัง Node B]

   %% การประมวลผลของ Node B
   B1[Node B: เริ่มเซิร์ฟเวอร์] --> B2[รอการเชื่อมต่อ]
   B2 --> B3[ยอมรับการเชื่อมต่อ]
   B3 --> B4[รับข้อมูลบล็อก]

   %% กระบวนการตรวจสอบบล็อก
   B4 --> B5[แปลงข้อมูล JSON]
   B5 --> B6[สร้างอินสแตนซ์บล็อก]
   B6 --> B7[คำนวณแฮชข้อมูลใหม่]
   B7 --> B8[คำนวณแฮชบล็อกใหม่]

   %% การเปรียบเทียบแฮช
   B8 --> B9[เปรียบเทียบแฮช:]
   B9 --> B9a[/"
       ตรวจสอบ:
       1. data_hash ตรงกัน
       2. block_hash ตรงกัน
   "/]

   %% ผลการตรวจสอบ
   B9a --> B10{แฮชทั้งหมดตรงกันหรือไม่?}
   B10 -->|ใช่| B11[เพิ่มบล็อกเข้าสู่บล็อกเชน]
   B11 --> B12[เพิ่มในประวัติธุรกรรม]
   B12 --> B13[ส่ง CONFIRM]
   B10 -->|ไม่ใช่| B14[บันทึกการตรวจสอบล้มเหลว]
   B14 --> B15[ส่ง ERROR]

   %% การจัดการผลตอบรับของ Node A
   A13 --> B4
   B13 --> A14[รับการยืนยัน]
   B15 --> A14
   A14 --> A15{การตอบกลับเป็น CONFIRM?}
   A15 -->|ใช่| A16[บันทึก Success]
   A15 -->|ไม่ใช่| A17[บันทึก Error]

   %% เส้นทางการจัดการข้อผิดพลาด
   A9 --> A18[จัดการการหมดเวลา]
   A9 --> A19[จัดการการปฏิเสธการเชื่อมต่อ]
   B4 --> B16[จัดการ JSON ที่ไม่ถูกต้อง]
   B4 --> B17[จัดการข้อผิดพลาดทั่วไป]

   %% การสิ้นสุด
   A16 --> A20[จบการทำงาน]
   A17 --> A21[จบการทำงานแบบล้มแหลวหรือError]
   A6 --> A21
   A11 --> A21

   %% การตกแต่ง
   classDef nodeA fill:#e6f3ff,stroke:#4d94ff,stroke-width:2px
   classDef nodeB fill:#f9f2ec,stroke:#d4a76a,stroke-width:2px
   classDef process fill:#f0f0f0,stroke:#666
   classDef decision fill:#ffe6e6,stroke:#ff8080,stroke-width:2px
   classDef data fill:#e6ffe6,stroke:#4da6ff,stroke-width:1px
   classDef error fill:#ffe6e6,stroke:#ff6666,stroke-width:1px

   class A1,A2,A3,A4,A7,A8,A9,A12,A13,A14,A16,A17,A20,A21 nodeA
   class B1,B2,B3,B4,B5,B6,B7,B8,B11,B12,B13,B14,B15 nodeB
   class A5,A10,B10,A15 decision
   class A8a,B9a data
   class A6,A11,A18,A19,B16,B17 error
